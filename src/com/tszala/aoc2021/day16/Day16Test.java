package com.tszala.aoc2021.day16;

import org.junit.jupiter.api.Assertions;
import org.junit.jupiter.api.Test;

import java.util.ArrayList;
import java.util.List;

public class Day16Test {

    @Test
    void shouldParseZeroAsLiteral() {
        String input = "110010100000000101111100110101010010101110001010011000111000101111110011000101001100111001001000011000111110010000111111100101111100111010001110001000101110100110000000001001010100000000010111000011001101010010110011110111111110111111001001111100110101001011001111011111111011111100100101010011010101000111001000110000000001101100010000000001110010001111110100011010001000110010100000000000001000011101000101110110001111001100011110010001000000000110111000100101110000011001100010100110110000000001001001010100101110101110110011011110110101111010010110101001100111001100110100110000110000000001010010011001110011111011100101001000111110000101011100000000001010111011100111111100110101101000101100110010100101101010111100100011110111010110101111100100110001100000000010100100110100111110110100000000011010101010001000000000110001000001001010001110000100001111110000000000000100001100100010101001000001000110001001000100001010100101000000000110101001111110101100100100001010011111100011000101000000100110011101011101000100110111000000001011111000110111110011110110001000111110101100110100010010011100101011100111001100100010010010010010011110011110111111011110110110000000000111101000100110001010010001111011111010001101001000111111101110101100000010000000010101010010011111111001100110000100100111000101011110100101001001110000110000000110010011000011111011001111010101110111111101001001010000000000000101101010001001101001000000000111110100110010100110011101001101001110000000000100110111110010100110001110110001110001101011001110100011011010011110110111011100110111000100000000001110100111011001010011000111110010000000000010000011100101110001001100110000000001000110010010101100111111111010000000001010010011101101111100110100100011111011010101010110101010011101101111100110100100011111011010101010110110100100000000010100000011001101100111110100100100000001010010001000110001001110101100101100100110101110001000000000011011011001001100110110110001111110110110100000111010011011100101000011100000000001001001101111100100111101100101100010001000000001000100010110011001100001001110100110001111001010001101100000000010010100110111100110001101111111011010111101001111111001110001001011010110011110011000000101100100000000010101100101001110101010100101100000000010001100101011000110011111001000001101100100101110011111110011011101000000110100010000000000111000100000001100000110110000000000101101101000010100000000001011011000000010100010111101010000000000111100000000001000111010100111000000000011110101000000000011010111000000000011000101000000000010110011000000000010010110000000010101101100001100000000001011001100000000001001010100000000001101000000000000110000111001100000000010010111100010000000000110101111011000000000001111110010010001100101110111011001111100010000000010011011010111100000000010001000000000000010000111010000101001100010000101000011000100010000000001100010000100111100001110001000011110110010011101001001010110010110010010000000000111101000101100000000010011100101100111110010010110011110111000110000110010101111001011110101010101100011000000000100111110000000000101111100100111111101010011111010110001110011100010010101000100011101110000000010010110011111101011101100101101100101011011111110101110100000010011010110100010001010011010111001001111111110111011011111110110101111000110000000001001110100000000011010100010001000000000111111000011001110000111110100010010100000000000000100001000100011101001000100010010000111110100110111101101010110001100000000100101100101010010111010010010010101001001110000110111100100100111001100000000000100111010110011000000000110011000110101110000100111100011010010010000000000100001011100010000011000001101110001100001001100000000011011100001010011000111011110001001111001000000000001101100010000010011100110110111000110010100011000001001110111100110001111111110111010110111100000000000010011011111001010011001101011010000100001100111011101111110110011110010111100110001000100100000000011111011011110000000001010010001100111111010110010110011100010111010111111001111110101100101100111000101110101101110010101110110011011000100000000100100010011101000000000100100001000000000111011000110000110001110000100010111100000000000000100001011100000111011000010011110000110111100111111000100100010001100000000010111111000000000001101101010000110000100110100001010010010111011010111001101110100000001001001110011010100011111010101101111000100100101001100000000010001101100000000010111100001001011001111111111100111000110110111111011100101100100111011100111100100111111010110100111000000110011011000000000010101011010010011110111000111110001001011000111000000000000000011101100011001111110011101001110110101100101110111100100010010101010011100110011100011111100001001110101011001001001110101111101010000000000010000011110010011011101101001111001010011001000000000100110010111010000000001010010010111010010111001011101001111100110111100111111001001100011000000000100001001101011100010011101010000000000100101001100110010110100010010001100100011110000110000000001011111000000000011001100000001000000000111101000001011010001000000100011111000001000000000110111000110011110001000110100001011011001111110110100111001011010000000010011000000000110011001011100011010100101010100000010010001010111110010000000001101111010100100111100011000111111011010110100110010001011010000000001001010011101111101111010110000110101001111101111001001000000000111001100011000000000001110010011001010010001100110110001110011101110001111110001000010001001101010110111011000111101010010111001100001101110000100000000100010100111001101010100100100110110010000010011100100010110101110011011000010000000";
        Day16.LiteralPacket literalPacket = Day16.PacketFactory.literalPacket(input);
        Assertions.assertEquals("100", literalPacket.type);
        Assertions.assertEquals("110", literalPacket.version);
        Assertions.assertEquals("1000000001", literalPacket.literalAsBinaryString());
        Assertions.assertEquals("1101001000000001",literalPacket.asBinary());
        Assertions.assertEquals("1101001000000001",literalPacket.asBinaryFilled());
    }

    @Test
    void shouldParseLiteral() {
        String input = "110100101111111000101000";
        Day16.LiteralPacket literalPacket = Day16.PacketFactory.literalPacket(input);
        Assertions.assertEquals("100", literalPacket.type);
        Assertions.assertEquals("110", literalPacket.version);
        Assertions.assertEquals("011111100101", literalPacket.literal);

        Assertions.assertEquals("110100101111111000101000",literalPacket.asBinaryFilled());
        Assertions.assertEquals("110100101111111000101",literalPacket.asBinary());
    }

    @Test
    void shouldParseOperatorWithLength() {
        String input = "00111000000000000110111101000101001010010001001000000000";
        Day16.OperatorPacket literalPacket = Day16.PacketFactory.operatorPacket(input);
        Assertions.assertEquals("001", literalPacket.version);
        Assertions.assertEquals("110", literalPacket.type);
        Assertions.assertEquals("0", literalPacket.lengthType);
        Assertions.assertEquals("000000000011011", literalPacket.length);
        Assertions.assertEquals("110100010100101001000100100", literalPacket.subPacketString);

        Assertions.assertEquals("00111000000000000110111101000101001010010001001000000000",literalPacket.asBinaryFilled());
        Assertions.assertEquals("0011100000000000011011110100010100101001000100100",literalPacket.asBinary());
    }

    @Test
    void shouldParseOperatorWithPacketCount() {
        String input = "11101110000000001101010000001100100000100011000001100000";
        Day16.OperatorPacket literalPacket = Day16.PacketFactory.operatorPacket(input);
        Assertions.assertEquals("111", literalPacket.version);
        Assertions.assertEquals("011", literalPacket.type);
        Assertions.assertEquals("1", literalPacket.lengthType);
        Assertions.assertEquals("00000000011", literalPacket.length);
        Assertions.assertEquals("010100000011001000001000110000011", literalPacket.subPacketString);

        Assertions.assertEquals("11101110000000001101010000001100100000100011000001100000",literalPacket.asBinaryFilled());
        Assertions.assertEquals("111011100000000011010100000011001000001000110000011",literalPacket.asBinary());
    }

    @Test
    void shouldDecodeTwoPackets() {
        String input = "11101110000000001101010000001100100000100011000001100000110100101111111000101000";
        List<Day16.Packet> packets = Day16.PacketFactory.decode(input, new ArrayList<>());
        Assertions.assertEquals(2, packets.size());
    }

    @Test
    void shouldDecodeThreePackets() {
        String input = "1110111000000000110101000000110010000010001100000110000011010010111111100010100000111000000000000110111101000101001010010001001000000000";
        List<Day16.Packet> packets = Day16.PacketFactory.decode(input, new ArrayList<>());
        Assertions.assertEquals(3, packets.size());
    }

    @Test
    void shouldDecodeNestedOperatorPackets() {
        String input = Day16.hexToBinaryString("8A004A801A8002F478");
        List<Day16.Packet> packets = Day16.PacketFactory.decode(input, new ArrayList<>());

        Assertions.assertEquals(1, packets.size());
        Assertions.assertEquals(16, packets.get(0).getVersionSumAsInt());
        Assertions.assertEquals(input, packets.get(0).asBinaryFilled());
    }

    @Test
    void shouldFindSum() {
        String input = Day16.hexToBinaryString("C200B40A82");
        List<Day16.Packet> packets = Day16.PacketFactory.decode(input, new ArrayList<>());
        Assertions.assertEquals(3, packets.get(0).value());
    }

    @Test
    void shouldFindProduct() {
        String input = Day16.hexToBinaryString("04005AC33890");
        List<Day16.Packet> packets = Day16.PacketFactory.decode(input, new ArrayList<>());
        Assertions.assertEquals(54, packets.get(0).value());
    }

}
